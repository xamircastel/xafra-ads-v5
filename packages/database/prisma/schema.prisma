// Xafra-ads v5 - Prisma Schema
// ACTUALIZADO: Estructura exacta de la base de datos real - 22 Sept 2025
// ¡IMPORTANTE! Este schema debe coincidir EXACTAMENTE con la BD de producción

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Customer model - Coincide EXACTAMENTE con tabla "customers"  
model Customer {
  id_customer BigInt  @id @default(autoincrement())
  name        String? @db.VarChar(1000)
  short_name  String? @db.VarChar(100)
  mail        String? @db.VarChar(200)
  phone       String? @db.VarChar(20)
  country     String? @db.VarChar(10)
  operator    String? @db.VarChar(50)

  // Relations
  products  Product[]
  authUsers AuthUser[]

  @@map("customers")
}

// Auth users - Coincide EXACTAMENTE con tabla "auth_users"
model AuthUser {
  id_auth           BigInt    @id @default(autoincrement())
  user_name         String?   @db.VarChar(50)
  shared_key        String?   @db.VarChar(50)
  api_key           String?   @db.VarChar(50)
  active            Int?      @db.SmallInt
  creation_date     DateTime? @default(now())
  customer_id       BigInt?   
  password          String?   @db.VarChar(255)
  status            Int?      @db.SmallInt @default(1)
  expiration_date   DateTime?   
  description       String?   @db.VarChar(500)
  permissions       String?   @db.VarChar(1000)
  login_count       Int?      @default(0)
  last_login        DateTime?   
  modification_date DateTime? 

  // Relations
  customer Customer? @relation(fields: [customer_id], references: [id_customer])

  @@map("auth_users")
}

// Product model - Coincide EXACTAMENTE con tabla "products"
model Product {
  id_product            BigInt  @id @default(autoincrement())
  reference             String? @db.VarChar(100)
  name                  String? @db.VarChar(500)
  url_redirect_success  String? @db.VarChar(1000)
  active                Int?    @db.SmallInt
  id_customer           BigInt?
  url_redirect_postback String? @db.VarChar(1000)
  method_postback       String? @db.VarChar(20)
  body_postback         String? @db.VarChar(2500)
  is_qs                 Int?    @db.SmallInt
  country               String? @db.VarChar(10)
  operator              String? @db.VarChar(50)
  random                Int?    @db.SmallInt
  encrypted_id          String? @db.VarChar(20)

  // Relations
  customer  Customer? @relation(fields: [id_customer], references: [id_customer])
  campaigns Campaign[]

  @@map("products")
}

// Campaign model - Coincide EXACTAMENTE con tabla "campaign"
model Campaign {
  id                BigInt    @id @default(autoincrement())
  creation_date     DateTime? @default(now())
  modification_date DateTime?
  id_product        BigInt?
  tracking          String?   @db.VarChar(500)
  status            Int?      @db.SmallInt
  uuid              String?   @db.VarChar(50)
  status_post_back  Int?      @db.SmallInt
  date_post_back    DateTime?
  params            String?   @db.Text
  xafra_tracking_id String?   @db.VarChar(100)
  short_tracking    String?   @db.VarChar(50)
  country           String?   @db.VarChar(50)
  operator          String?   @db.VarChar(50)

  // Relations
  product Product? @relation(fields: [id_product], references: [id_product])

  @@map("campaign")
}

// Ads model - Coincide EXACTAMENTE con tabla "ads"
model Ads {
  ads_id      BigInt    @id @default(autoincrement())
  ads_conf_id BigInt
  ads_def_id  BigInt
  priority    Int?      @db.SmallInt
  status      Int?      @db.SmallInt
  cdate       DateTime? @default(now())

  // Relations 
  ads_conf AdsConf? @relation(fields: [ads_conf_id], references: [ads_conf_id])
  ads_def  AdsDef?  @relation(fields: [ads_def_id], references: [ads_def_id])

  @@map("ads")
}

// Ads Configuration model - Coincide EXACTAMENTE con tabla "ads_conf"
model AdsConf {
  ads_conf_id BigInt    @id @default(autoincrement())
  name        String?   @db.VarChar(100)
  status      Int?      @db.SmallInt
  cdate       DateTime? @default(now())

  // Relations
  ads Ads[]

  @@map("ads_conf")
}

// Ads Definition model - Coincide EXACTAMENTE con tabla "ads_def"
model AdsDef {
  ads_def_id   BigInt    @id @default(autoincrement())
  ads_conf_id  BigInt
  product_id   BigInt
  use_tracking Int?      @db.SmallInt
  status       Int?      @db.SmallInt
  cdate        DateTime? @default(now())

  // Relations
  ads Ads[]

  @@map("ads_def")
}

// Blacklist model - Coincide EXACTAMENTE con tabla "blacklist"
model Blacklist {
  id            BigInt    @id @default(autoincrement())
  msisdn        String?   @db.VarChar(20)
  creation_date DateTime?
  product_id    BigInt?
  type          Int?      @db.SmallInt

  @@map("blacklist")
}

// Xafra Campaign model - Coincide EXACTAMENTE con tabla "xafra_campaign"
model XafraCampaign {
  id         BigInt    @id @default(autoincrement())
  xafra_id   BigInt
  product_id BigInt?
  tracking   String    @db.VarChar(50)
  status     Int?      @db.SmallInt
  uuid       String?   @db.VarChar(50)
  cdate      DateTime? @default(now())
  mdate      DateTime?

  @@map("xafra_campaign")
}